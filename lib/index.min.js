"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("statuses")),r=e(require("assert")),o=e(require("raw-body")),i=e(require("inflation")),s=e(require("semver")),n=require("type-is"),p=e(require("content-type")),a=e(require("querystring")),c=require("url"),l=e(require("parseurl")),u=e(require("fresh")),y=e(require("net")),h=require("mime-types"),d=require("path"),b=e(d),g=e(require("on-finished")),m=e(require("destroy")),O=e(require("vary")),f=e(require("error-inject")),w=e(require("content-disposition")),j=e(require("escape-html")),D=e(require("keygrip")),P=e(require("cookies")),v=e(require("accepts")),N=e(require("http-errors")),x=e(require("path-to-regexp")),E=e(require("events")),S=e(require("http")),z=e(require("stream"));var M=function(e,t,r,o){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(o):void 0})};var q=function(e,t,r,o,i){var s={};return Object.keys(o).forEach((function(e){s[e]=o[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce((function(r,o){return o(e,t,r)||r}),s),i&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(i):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s};const k=Symbol.for("~metaObject");function C(e,t,o){const i=null!=e[k];r(!i,"Decorator `action` may be used with instance methods only");const s=o.value||o.initializer&&o.initializer(),n=e.constructor;return r(n.isExtensible,`Class '${e.name}' has been frozen previously. Method '${t}' can not be declared`),Reflect.defineProperty(s,"name",{value:t,configurable:!0}),Reflect.defineProperty(s,"isAsync",{value:!0,configurable:!0}),n.metaObject.addMetaData("instanceMethods",t,s),n.metaObject.addMetaData("actions",t,s),{configurable:o.configurable,enumerable:o.enumerable,writable:!1,value:s}}const $=Symbol.for("~metaObject"),I=Symbol.for("~templatesList");var A=e=>{const{initializeMixin:t,meta:r,method:s,property:n}=e.NS;e.defineMixin("/mixins/BodyParseMixin.js",(e=>{var p,a,c,l,u,y;return t((y=u=class extends e{constructor(...e){super(...e),M(this,"withRawBody",l,this)}_parse(e,{strict:t}){if(!t)return e?JSON.parse(e):e;if(!e)return{};if(!/^[\x20\x09\x0a\x0d]*(\[|\{)/.test(e))throw new SyntaxError("invalid JSON, only supports object and array");return JSON.parse(e)}async parseBody(...e){const t={},r=this.context.req.headers["content-length"],s=this.context.req.headers["content-encoding"]||"identity";r&&"identity"===s&&(t.length=~~r),t.encoding="utf8",t.limit="1mb";const n=await o(i(req),t);try{const t=this._parse(n,{strict:true});return this.context.request.body=t,this.withRawBody&&(this.context.request.raw=n),e}catch(e){throw e.status=400,e.body=n,e}}},u.object={},q(a=y,"object",[r],(c=(c=Object.getOwnPropertyDescriptor(a,"object"))?c.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return c}}),a),l=q(a.prototype,"withRawBody",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),q(a.prototype,"_parse",[s],Object.getOwnPropertyDescriptor(a.prototype,"_parse"),a.prototype),q(a.prototype,"parseBody",[s],Object.getOwnPropertyDescriptor(a.prototype,"parseBody"),a.prototype),p=a))||p}))},B=e=>{const{initializeMixin:t,meta:r,method:o}=e.NS;e.defineMixin("/mixins/BulkMethodsRendererMixin.js",(e=>{var i,s,n,p,a;return t((a=p=class extends e{async bulkDelete(e,t,r,o){}async bulkDestroy(e,t,r,o){}async render(e,t,r,o={}){const i=arguments,{path:s,resource:n,action:p,template:a}=o;if(null!=s&&null!=n&&null!=p){const{Templates:e}=this.Module.NS;return await Promise.resolve().then((()=>{const o=null!=e?e[a]:void 0;return _.isFunction(o)?o.call(r,n,p,t):_.includes(["bulkDelete","bulkDestroy"],p)?this[p].call(r,n,p,t,a):super.render(...i)}))}return t}},p.object={},q(s=a,"object",[r],(n=(n=Object.getOwnPropertyDescriptor(s,"object"))?n.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return n}}),s),q(s.prototype,"bulkDelete",[o],Object.getOwnPropertyDescriptor(s.prototype,"bulkDelete"),s.prototype),q(s.prototype,"bulkDestroy",[o],Object.getOwnPropertyDescriptor(s.prototype,"bulkDestroy"),s.prototype),q(s.prototype,"render",[o],Object.getOwnPropertyDescriptor(s.prototype,"render"),s.prototype),i=s))||i}))},H=e=>{const{initializeMixin:t,meta:r,method:o,Utils:{statuses:i}}=e.NS,s=i("unauthorized"),n=i("forbidden");e.defineMixin("/mixins/CheckAdminOnlyResourceMixin.js",(e=>{var i,p,a,c,l;return t((l=c=class extends e{async adminOnly(...e){if(null!=this.session.uid){if(this.session.userIsAdmin)return e;this.context.throw(n)}else this.context.throw(s)}},c.object={},q(p=l,"object",[r],(a=(a=Object.getOwnPropertyDescriptor(p,"object"))?a.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return a}}),p),q(p.prototype,"adminOnly",[o],Object.getOwnPropertyDescriptor(p.prototype,"adminOnly"),p.prototype),i=p))||i}))},U=e=>{const{initializeMixin:t,meta:r,method:o,Utils:{assert:i,statuses:n}}=e.NS,p=n("upgrade required");e.defineMixin("/mixins/CheckApiVersionResourceMixin.js",(e=>{var n,a,c,l,u;return t((u=l=class extends e{async checkApiVersion(...e){const t=this.context.pathParams.v;i(null!=this.configs,`Needs to add '@mixin(ConfigurableMixin)' decorator to ${this.constructor.name}`);const r=this.configs.version;i(null!=r,"No `version` specified in the configuration");const[o]=r.match(/^\d{1,}[.]\d{1,}/)||[];return i(null!=o,"Incorrect `version` specified in the configuration"),s.satisfies(r,t)||this.context.throw(p,`Upgrade: v${r}`),e}},l.object={},q(a=u,"object",[r],(c=(c=Object.getOwnPropertyDescriptor(a,"object"))?c.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return c}}),a),q(a.prototype,"checkApiVersion",[o],Object.getOwnPropertyDescriptor(a.prototype,"checkApiVersion"),a.prototype),n=a))||n}))};const F=[].slice;var G=e=>{const{initializeMixin:t,meta:r,method:o,property:i,inject:s,Utils:{assert:n}}=e.NS;e.defineMixin("/mixins/CheckSchemaVersionResourceMixin.js",(e=>{var p,a,c,l,u,y,h;return p=s("CollectionFactory<*>"),t((h=y=class extends e{constructor(...e){super(...e),M(this,"_collectionFactory",u,this)}get _migrations(){return this._collectionFactory(this.ApplicationModule.NS.MIGRATIONS)}async checkSchemaVersion(...e){const t=this.ApplicationModule.NS.MIGRATION_NAMES,[r]=F.call(t,-1);if(null==r)return e;return await this._migrations.includes(r)||n.fail("Code schema version is not equal current DB version"),e}},y.object={},q(c=h,"object",[r],(l=(l=Object.getOwnPropertyDescriptor(c,"object"))?l.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return l}}),c),u=q(c.prototype,"_collectionFactory",[p,i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q(c.prototype,"_migrations",[i],Object.getOwnPropertyDescriptor(c.prototype,"_migrations"),c.prototype),q(c.prototype,"checkSchemaVersion",[o],Object.getOwnPropertyDescriptor(c.prototype,"checkSchemaVersion"),c.prototype),a=c))||a}))},V=e=>{const{RESOURCE_RESULT:t,initializeMixin:r,meta:o,method:i}=e.NS;e.defineMixin("/mixins/ContextifyApplicationMediatorMixin.js",(e=>{var s,n,p,a,c;return r((c=a=class extends e{listNotificationInterests(...e){const r=super.listNotificationInterests(...e);return r.push(t),r}handleNotification(e){const r=e.getName(),o=e.getBody(),i=e.getType();switch(r){case t:this.emitter.emit(i,o);break;default:super.handleNotification(e)}}async execute(e,t,r){const{context:o,reverse:i}=t;return await new Promise(((t,s)=>{try{this.emitter.once(i,(({error:e,result:r,resource:o})=>{null==e?t({result:r,resource:o}):s(e)})),this.send(e,{context:o,reverse:i},r,null)}catch(e){s(e)}}))}},a.object={},q(n=c,"object",[o],(p=(p=Object.getOwnPropertyDescriptor(n,"object"))?p.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return p}}),n),q(n.prototype,"listNotificationInterests",[i],Object.getOwnPropertyDescriptor(n.prototype,"listNotificationInterests"),n.prototype),q(n.prototype,"handleNotification",[i],Object.getOwnPropertyDescriptor(n.prototype,"handleNotification"),n.prototype),q(n.prototype,"execute",[i],Object.getOwnPropertyDescriptor(n.prototype,"execute"),n.prototype),s=n))||s}))},J=e=>{const{APPLICATION_MEDIATOR:t,initializeMixin:r,meta:o,method:i,property:s}=e.NS;e.defineMixin("/mixins/ContextifyApplicationMixin.js",(e=>{var n,p,a,c,l,u;return r((u=l=class extends e{constructor(...e){super(...e),M(this,"context",c,this)}async execute(e,r,o){this.context=r.context;const i=this.facade.getMediator(t);return await i.execute(e,r,o)}},l.object={},q(p=u,"object",[o],(a=(a=Object.getOwnPropertyDescriptor(p,"object"))?a.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return a}}),p),c=q(p.prototype,"context",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q(p.prototype,"execute",[i],Object.getOwnPropertyDescriptor(p.prototype,"execute"),p.prototype),n=p))||n}))},Q=e=>{const{APPLICATION_MEDIATOR:t,LIGHTWEIGHT:r,RESOURCE_RESULT:o,initializeMixin:i,meta:s,method:n,property:p,inject:a}=e.NS;e.defineMixin("/mixins/ContextifyResourceExecutionMixin.js",(c=>{var l,u,y,h,d,b,g;return l=a(`Factory<${t}>`),i((g=b=class extends c{constructor(...e){super(...e),M(this,"_appMediatorFactory",d,this)}get _appMediator(){return this._appMediatorFactory()}async execute(t){let i;const{ERROR:s,DEBUG:n,LEVELS:p,SEND_TO_LOG:a}=e.NS.Pipes.NS.LogMessage,c=t.getName(),l=t.getBody(),u=t.getType(),y=this._appMediator.getViewComponent();try{if(null!=y.context)return await super.execute(t);{this.send(a,">>>>>>>>>> LIGHTWEIGHT CREATE",p[n]);const e=Date.now(),t=this.Module.NS.MainApplication.new(r);t.start(),this.send(a,">>>>>>>>>> LIGHTWEIGHT START after "+(Date.now()-e),p[n]),i=await t.execute(c,l,u),this.send(a,">>>>>>>>>> LIGHTWEIGHT END",p[n]);const o=Date.now();await t.finish(),this.send(a,">>>>>>>>>> LIGHTWEIGHT DESTROYED after "+(Date.now()-o),p[n])}}catch(e){i={error:e,resource:this}}this.send(o,i,l.reverse)}},b.object={},q(y=g,"object",[s],(h=(h=Object.getOwnPropertyDescriptor(y,"object"))?h.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return h}}),y),d=q(y.prototype,"_appMediatorFactory",[l,p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q(y.prototype,"_appMediator",[p],Object.getOwnPropertyDescriptor(y.prototype,"_appMediator"),y.prototype),q(y.prototype,"execute",[n],Object.getOwnPropertyDescriptor(y.prototype,"execute"),y.prototype),u=y))||u}))},W=e=>{const{initializeMixin:t,meta:r,method:o}=e.NS;e.defineMixin("/mixins/CountMethodsRendererMixin.js",(e=>{var i,s,n,p,a;return t((a=p=class extends e{async count(e,t,r,o){return r}async length(e,t,r,o){return r}async render(e,t,r,o={}){const i=arguments,{path:s,resource:n,action:p,template:a}=o;if(null!=s&&null!=n&&null!=p){const{Templates:e}=this.Module.NS;return await Promise.resolve().then((()=>{const o=null!=e?e[a]:void 0;return _.isFunction(o)?o.call(r,n,p,t):_.includes(["count","length"],p)?this[p].call(r,n,p,t,a):super.render(...i)}))}return t}},p.object={},q(s=a,"object",[r],(n=(n=Object.getOwnPropertyDescriptor(s,"object"))?n.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return n}}),s),q(s.prototype,"count",[o],Object.getOwnPropertyDescriptor(s.prototype,"count"),s.prototype),q(s.prototype,"length",[o],Object.getOwnPropertyDescriptor(s.prototype,"length"),s.prototype),q(s.prototype,"render",[o],Object.getOwnPropertyDescriptor(s.prototype,"render"),s.prototype),i=s))||i}))},X=e=>{const{initializeMixin:t,meta:r,method:o,Utils:{_:i}}=e.NS;e.defineMixin("/mixins/CrudRendererMixin.js",(e=>{var s,n,p,a,c;return t((c=a=class t extends e{async create(e,r,o,i){const s=i.replace(new RegExp(`/${r}$`),"/itemDecorator"),n=this.Module.NS.Templates[s]||t.prototype.itemDecorator;return{[this.itemEntityName]:await n.call(this,o)}}async delete(e,t,r,o){}async destroy(e,t,r,o){}async detail(e,r,o,i){const s=i.replace(new RegExp(`/${r}$`),"/itemDecorator"),n=this.Module.NS.Templates[s]||t.prototype.itemDecorator;return{[this.itemEntityName]:await n.call(this,o)}}async itemDecorator(e){if(null!=e){result=JSON.parse(JSON.stringify(e));let{createdAt:t,updatedAt:r,deletedAt:o}=e;t=t&&t.toISOString()||null,r=r&&r.toISOString()||null,o=o&&o.toISOString()||null,result.createdAt=t,result.updatedAt=r,result.deletedAt=o}else result=null;return result}async list(e,r,o,i){const s=i.replace(new RegExp(`/${r}$`),"/itemDecorator"),n=this.Module.NS.Templates[s]||t.prototype.itemDecorator;return{meta:o.meta,[this.listEntityName]:await Promise.all(o.items.map(n.bind(this)))}}async query(e,t,r,o){return r}async update(e,r,o,i){const s=i.replace(new RegExp(`/${r}$`),"/itemDecorator"),n=this.Module.NS.Templates[s]||t.prototype.itemDecorator;return{[this.itemEntityName]:await n.call(this,o)}}async render(e,t,r,o={}){const s=arguments,{path:n,resource:p,action:a,template:c}=o;if(null!=n&&null!=p&&null!=a){const{Templates:e}=this.Module.NS;return await Promise.resolve().then((()=>{const o=null!=e?e[c]:void 0;return i.isFunction(o)?o.call(r,p,a,t):i.includes(["create","delete","destroy","detail","list","update"],a)?this[a].call(r,p,a,t,c):super.render(...s)}))}return t}},a.object={},q(n=c,"object",[r],(p=(p=Object.getOwnPropertyDescriptor(n,"object"))?p.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return p}}),n),q(n.prototype,"create",[o],Object.getOwnPropertyDescriptor(n.prototype,"create"),n.prototype),q(n.prototype,"delete",[o],Object.getOwnPropertyDescriptor(n.prototype,"delete"),n.prototype),q(n.prototype,"destroy",[o],Object.getOwnPropertyDescriptor(n.prototype,"destroy"),n.prototype),q(n.prototype,"detail",[o],Object.getOwnPropertyDescriptor(n.prototype,"detail"),n.prototype),q(n.prototype,"itemDecorator",[o],Object.getOwnPropertyDescriptor(n.prototype,"itemDecorator"),n.prototype),q(n.prototype,"list",[o],Object.getOwnPropertyDescriptor(n.prototype,"list"),n.prototype),q(n.prototype,"query",[o],Object.getOwnPropertyDescriptor(n.prototype,"query"),n.prototype),q(n.prototype,"update",[o],Object.getOwnPropertyDescriptor(n.prototype,"update"),n.prototype),q(n.prototype,"render",[o],Object.getOwnPropertyDescriptor(n.prototype,"render"),n.prototype),s=n))||s}))},K=e=>{const{initializeMixin:t,meta:r,method:o,chains:i,Utils:{_:s}}=e.NS;e.defineMixin("/mixins/EditableResourceMixin.js",(e=>{var n,p,a,c,l,u;return n=i((function(){this.beforeHook("protectEditable",{only:["create","update","delete"]}),this.beforeHook("setCurrentUserOnCreate",{only:["create"]}),this.beforeHook("setCurrentUserOnUpdate",{only:["update"]}),this.beforeHook("setCurrentUserOnDelete",{only:["delete"]})})),t(p=n((u=l=class extends e{async setCurrentUserOnCreate(...e){return this.recordBody.creatorId=this.session.uid||null,this.recordBody.editorId=this.recordBody.creatorId,e}async setCurrentUserOnUpdate(...e){return this.recordBody.editorId=this.session.uid||null,e}async setCurrentUserOnDelete(...e){return this.recordBody.editorId=this.session.uid||null,this.recordBody.removerId=this.recordBody.editorId,e}async protectEditable(...e){return this.recordBody=s.omit(this.recordBody,["creatorId","editorId","removerId"]),e}},l.object={},q(a=u,"object",[r],(c=(c=Object.getOwnPropertyDescriptor(a,"object"))?c.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return c}}),a),q(a.prototype,"setCurrentUserOnCreate",[o],Object.getOwnPropertyDescriptor(a.prototype,"setCurrentUserOnCreate"),a.prototype),q(a.prototype,"setCurrentUserOnUpdate",[o],Object.getOwnPropertyDescriptor(a.prototype,"setCurrentUserOnUpdate"),a.prototype),q(a.prototype,"setCurrentUserOnDelete",[o],Object.getOwnPropertyDescriptor(a.prototype,"setCurrentUserOnDelete"),a.prototype),q(a.prototype,"protectEditable",[o],Object.getOwnPropertyDescriptor(a.prototype,"protectEditable"),a.prototype),p=a))||p)||p}))},Y=e=>{const{initializeMixin:t,meta:r,method:o,property:i,Utils:{_:s,statuses:n}}=e.NS,p=n("not found"),a=n("unauthorized"),c=n("forbidden");e.defineMixin("/mixins/OwnerableResourceMixin.js",(e=>{var n,l,u,y,h,d;return t((d=h=class extends e{constructor(...e){super(...e),M(this,"listQuery",y,this)}async setOwnerId(...e){return this.recordBody.ownerId=this.session.uid||null,e}async protectOwnerId(...e){return this.recordBody=s.omit(this.recordBody,["ownerId"]),e}async filterOwnerByCurrentUser(...e){return null!=this.listQuery.$filter?this.listQuery.$filter={$and:[this.listQuery.$filter,{"@doc.ownerId":{$eq:this.session.uid}}]}:this.listQuery.$filter={"@doc.ownerId":{$eq:this.session.uid}},e}async checkOwner(...e){if(null==this.session.uid)return void this.context.throw(a);if(this.session.userIsAdmin)return e;const t=this.context.pathParams[this.keyName];if(null==t)return e;const r=await this.collection.find(t);return null==r&&this.context.throw(p),r.ownerId?this.session.uid===r.ownerId?e:void this.context.throw(c):e}},h.object={},q(l=d,"object",[r],(u=(u=Object.getOwnPropertyDescriptor(l,"object"))?u.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return u}}),l),y=q(l.prototype,"listQuery",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),q(l.prototype,"setOwnerId",[o],Object.getOwnPropertyDescriptor(l.prototype,"setOwnerId"),l.prototype),q(l.prototype,"protectOwnerId",[o],Object.getOwnPropertyDescriptor(l.prototype,"protectOwnerId"),l.prototype),q(l.prototype,"filterOwnerByCurrentUser",[o],Object.getOwnPropertyDescriptor(l.prototype,"filterOwnerByCurrentUser"),l.prototype),q(l.prototype,"checkOwner",[o],Object.getOwnPropertyDescriptor(l.prototype,"checkOwner"),l.prototype),n=l))||n}))},Z=e=>{const{APPLICATION_MEDIATOR:t,initializeMixin:r,meta:o,method:i}=e.NS;e.defineMixin("/mixins/PerformSyntheticRequestApplicationMixin.js",(e=>{var s,n,p,a,c;return r((c=a=class extends e{async perform(e,r,o){const i=this.facade.getMediator(t);return await i.perform,T,R,L>o}},a.object={},q(n=c,"object",[o],(p=(p=Object.getOwnPropertyDescriptor(n,"object"))?p.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return p}}),n),q(n.prototype,"perform",[i],Object.getOwnPropertyDescriptor(n.prototype,"perform"),n.prototype),s=n))||s}))},ee=e=>{const{HTTP_MEDIATOR:t,initializeMixin:r,meta:o,method:i,property:s,inject:n}=e.NS;e.defineMixin("/mixins/PerformSyntheticRequestMixin.js",(e=>{var p,a,c,l,u,y,h;return p=n(`Factory<${t}>`),r((h=y=class extends e{constructor(...e){super(...e),M(this,"_httpMediatorFactory",u,this)}get _httpMediator(){return this._httpMediatorFactory()}async perform(e,t,r){if(null!=this._httpMediator)return await this._httpMediator.perform,T,R,L>r}},y.object={},q(c=h,"object",[o],(l=(l=Object.getOwnPropertyDescriptor(c,"object"))?l.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return l}}),c),u=q(c.prototype,"_httpMediatorFactory",[p,s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q(c.prototype,"_httpMediator",[s],Object.getOwnPropertyDescriptor(c.prototype,"_httpMediator"),c.prototype),q(c.prototype,"perform",[i],Object.getOwnPropertyDescriptor(c.prototype,"perform"),c.prototype),a=c))||a}))},te=e=>{const{JSON_RENDERER:t,initializeMixin:r,meta:o,method:i}=e.NS;e.defineMixin("/mixins/RestfulFacadeMixin.js",(e=>{var s,n,p,a,c;return r((c=a=class extends e{initializeFacade(){super.initializeFacade(...arguments),this.isBound("Context")||this.bind("Context").to(this.Module.NS.Context),this.isBound("Factory<Context>")||this.bind("Factory<Context>").toFactory((e=>()=>this.get("Context"))),this.isBound("HttpRequest")||this.bind("HttpRequest").to(this.Module.NS.HttpRequest),this.isBound("HttpResponse")||this.bind("HttpResponse").to(this.Module.NS.HttpResponse),this.isBound("HttpCookies")||this.bind("HttpCookies").to(this.Module.NS.HttpCookies),this.isBound(t)||this.bind(t).to(this.Module.NS.Renderer).inSingletonScope(),this.isBound("RendererFactory<*>")||this.bind("RendererFactory<*>").toFactory((e=>e=>this.get(e))),this.isBound("RouterFactory<*>")||this.bind("RouterFactory<*>").toFactory((e=>e=>this.get(`Factory<${e}>`)())),this.isBound("ResourceChecker<*>")||this.bind("ResourceChecker<*>").toFactory((e=>e=>this.isBound(`Factory<${e}>`)))}},a.object={},q(n=c,"object",[o],(p=(p=Object.getOwnPropertyDescriptor(n,"object"))?p.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return p}}),n),q(n.prototype,"initializeFacade",[i],Object.getOwnPropertyDescriptor(n.prototype,"initializeFacade"),n.prototype),s=n))||s}))},re=e=>{var t,r,o,i,s,h,d,b,g,m;const{CoreObject:O,assert:f,initialize:w,partOf:j,meta:_,property:D,method:P,nameBy:v,mixin:N,injectable:R,Utils:{_:x}}=e.NS;w(t=R()(t=j(e)((m=g=class extends O{constructor(...e){super(...e),M(this,"_req",s,this),M(this,"ctx",h,this),M(this,"body",d,this),M(this,"raw",b,this)}get req(){return this._req}get header(){return this.headers}get headers(){return this.req.headers}get originalUrl(){return this.ctx.originalUrl}get url(){return this.req.url}set url(e){return this.req.url=e}get origin(){return`${this.protocol}://${this.host}`}get href(){return/^https?:\/\//i.test(this.originalUrl)?this.originalUrl:this.origin+this.originalUrl}get method(){return this.req.method}set method(e){return this.req.method=e}get path(){return l(this.req).pathname}set path(e){const t=l(this.req);return t.pathname===e?e:(t.pathname=e,t.path=null,this.url=c.format(t))}get query(){return a.parse(this.querystring)}set query(e){return this.querystring=a.stringify(e),e}get querystring(){return null==this.req?"":null!=l(this.req)?l(this.req).query:""}set querystring(e){const t=l(this.req);return t.search===`?${e}`?e:(t.search=e,t.path=null,this.url=c.format(t))}get search(){return this.querystring?`?${this.querystring}`:""}set search(e){return this.querystring=e}get host(){const e=null!=this.configs&&null!=this.configs.trustProxy&&this.configs.trustProxy&&this.get("X-Forwarded-Host")||this.get("Host");return e?e.split(/\s*,\s*/)[0]:""}get hostname(){return this.host?this.host.split(":")[0]:""}get fresh(){const e=this.method,t=this.ctx.status;return("GET"===e||"HEAD"===e)&&((t>=200&&t<300||304==t)&&u(this.headers,this.ctx.response.headers))}get stale(){return!this.fresh}get idempotent(){return x.includes(["GET","HEAD","PUT","DELETE","OPTIONS","TRACE"],this.method)}get socket(){return this.req.socket}get charset(){let e=this.get("Content-Type");if(null==e)return"";try{e=p.parse(e)}catch(e){return""}return e.parameters.charset||""}get length(){const e=this.get("Content-Length");return null!=e?""===e?0:~~Number(e):0}get protocol(){const e=null!=this.configs&&null!=this.configs.trustProxy&&this.configs.trustProxy;if(null!=this.socket?this.socket.encrypted:void 0)return"https";if(this.req.secure)return"https";if(!e)return"http";return(this.get("X-Forwarded-Proto")||"http").split(/\s*,\s*/)[0]}get secure(){return"https"===this.protocol}get ip(){const e=this.req.socket&&this.req.socket.remoteAddress,t=this.req.remoteAddress;return this.ips[0]||e||t||""}get ips(){const e=null!=this.configs&&null!=this.configs.trustProxy&&this.configs.trustProxy,t=this.get("X-Forwarded-For");return null!=e&&null!=t?t.split(/\s*,\s*/):[]}get subdomains(){const e=null!=this.configs&&null!=this.configs.subdomainOffset?this.configs.subdomainOffset:2,t=this.hostname;return 0!=y.isIP(t)?[]:t.split(".").reverse().slice(e)}accepts(...e){return this.ctx.accept.types(...e)}acceptsCharsets(...e){return this.ctx.accept.charsets(...e)}acceptsEncodings(...e){return this.ctx.accept.encodings(...e)}acceptsLanguages(...e){return this.ctx.accept.languages(...e)}is(...e){let[t]=e;return t?(x.isArray(t)||(t=e),n.is(this.req,t)):n.is(this.req)}get type(){const e=this.get("Content-Type");return null==e?"":e.split(";")[0]}get(e){switch(e=e.toLowerCase()){case"referer":case"referrer":return this.req.headers.referrer||this.req.headers.referer||"";default:return this.req.headers[e]||""}}setContext(e){this.ctx=e}setReq(e){this._req=e}static async restoreObject(){f.fail(`restoreObject method not supported for ${this.name}`)}static async replicateObject(){f.fail(`replicateObject method not supported for ${this.name}`)}},g.__filename="/context/HttpRequest.js",g.object={},q(r=m,"__filename",[v],(o=(o=Object.getOwnPropertyDescriptor(r,"__filename"))?o.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return o}}),r),q(r,"object",[_],(i=(i=Object.getOwnPropertyDescriptor(r,"object"))?i.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return i}}),r),s=q(r.prototype,"_req",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q(r.prototype,"req",[D],Object.getOwnPropertyDescriptor(r.prototype,"req"),r.prototype),h=q(r.prototype,"ctx",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=q(r.prototype,"body",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=q(r.prototype,"raw",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q(r.prototype,"header",[D],Object.getOwnPropertyDescriptor(r.prototype,"header"),r.prototype),q(r.prototype,"headers",[D],Object.getOwnPropertyDescriptor(r.prototype,"headers"),r.prototype),q(r.prototype,"originalUrl",[D],Object.getOwnPropertyDescriptor(r.prototype,"originalUrl"),r.prototype),q(r.prototype,"url",[D],Object.getOwnPropertyDescriptor(r.prototype,"url"),r.prototype),q(r.prototype,"url",[D],Object.getOwnPropertyDescriptor(r.prototype,"url"),r.prototype),q(r.prototype,"origin",[D],Object.getOwnPropertyDescriptor(r.prototype,"origin"),r.prototype),q(r.prototype,"href",[D],Object.getOwnPropertyDescriptor(r.prototype,"href"),r.prototype),q(r.prototype,"method",[D],Object.getOwnPropertyDescriptor(r.prototype,"method"),r.prototype),q(r.prototype,"method",[D],Object.getOwnPropertyDescriptor(r.prototype,"method"),r.prototype),q(r.prototype,"path",[D],Object.getOwnPropertyDescriptor(r.prototype,"path"),r.prototype),q(r.prototype,"path",[D],Object.getOwnPropertyDescriptor(r.prototype,"path"),r.prototype),q(r.prototype,"query",[D],Object.getOwnPropertyDescriptor(r.prototype,"query"),r.prototype),q(r.prototype,"query",[D],Object.getOwnPropertyDescriptor(r.prototype,"query"),r.prototype),q(r.prototype,"querystring",[D],Object.getOwnPropertyDescriptor(r.prototype,"querystring"),r.prototype),q(r.prototype,"querystring",[D],Object.getOwnPropertyDescriptor(r.prototype,"querystring"),r.prototype),q(r.prototype,"search",[D],Object.getOwnPropertyDescriptor(r.prototype,"search"),r.prototype),q(r.prototype,"search",[D],Object.getOwnPropertyDescriptor(r.prototype,"search"),r.prototype),q(r.prototype,"host",[D],Object.getOwnPropertyDescriptor(r.prototype,"host"),r.prototype),q(r.prototype,"hostname",[D],Object.getOwnPropertyDescriptor(r.prototype,"hostname"),r.prototype),q(r.prototype,"fresh",[D],Object.getOwnPropertyDescriptor(r.prototype,"fresh"),r.prototype),q(r.prototype,"stale",[D],Object.getOwnPropertyDescriptor(r.prototype,"stale"),r.prototype),q(r.prototype,"idempotent",[D],Object.getOwnPropertyDescriptor(r.prototype,"idempotent"),r.prototype),q(r.prototype,"socket",[D],Object.getOwnPropertyDescriptor(r.prototype,"socket"),r.prototype),q(r.prototype,"charset",[D],Object.getOwnPropertyDescriptor(r.prototype,"charset"),r.prototype),q(r.prototype,"length",[D],Object.getOwnPropertyDescriptor(r.prototype,"length"),r.prototype),q(r.prototype,"protocol",[D],Object.getOwnPropertyDescriptor(r.prototype,"protocol"),r.prototype),q(r.prototype,"secure",[D],Object.getOwnPropertyDescriptor(r.prototype,"secure"),r.prototype),q(r.prototype,"ip",[D],Object.getOwnPropertyDescriptor(r.prototype,"ip"),r.prototype),q(r.prototype,"ips",[D],Object.getOwnPropertyDescriptor(r.prototype,"ips"),r.prototype),q(r.prototype,"subdomains",[D],Object.getOwnPropertyDescriptor(r.prototype,"subdomains"),r.prototype),q(r.prototype,"accepts",[P],Object.getOwnPropertyDescriptor(r.prototype,"accepts"),r.prototype),q(r.prototype,"acceptsCharsets",[P],Object.getOwnPropertyDescriptor(r.prototype,"acceptsCharsets"),r.prototype),q(r.prototype,"acceptsEncodings",[P],Object.getOwnPropertyDescriptor(r.prototype,"acceptsEncodings"),r.prototype),q(r.prototype,"acceptsLanguages",[P],Object.getOwnPropertyDescriptor(r.prototype,"acceptsLanguages"),r.prototype),q(r.prototype,"is",[P],Object.getOwnPropertyDescriptor(r.prototype,"is"),r.prototype),q(r.prototype,"type",[D],Object.getOwnPropertyDescriptor(r.prototype,"type"),r.prototype),q(r.prototype,"get",[P],Object.getOwnPropertyDescriptor(r.prototype,"get"),r.prototype),q(r.prototype,"setContext",[P],Object.getOwnPropertyDescriptor(r.prototype,"setContext"),r.prototype),q(r.prototype,"setReq",[P],Object.getOwnPropertyDescriptor(r.prototype,"setReq"),r.prototype),q(r,"restoreObject",[P],Object.getOwnPropertyDescriptor(r,"restoreObject"),r),q(r,"replicateObject",[P],Object.getOwnPropertyDescriptor(r,"replicateObject"),r),t=r))||t)||t)};const oe={}.hasOwnProperty;var ie=e=>{var t,r,o,i,s,p,a,c;const{CoreObject:l,assert:u,initialize:y,partOf:b,meta:_,property:D,method:P,nameBy:v,injectable:N,Utils:{_:R,statuses:x,assign:E}}=e.NS;y(t=N()(t=b(e)((c=a=class extends l{constructor(...e){super(...e),M(this,"_res",s,this),M(this,"ctx",p,this)}get res(){return this._res}get socket(){return this.ctx.req.socket}get header(){return this.headers}get headers(){return R.isFunction(this.res.getHeaders)?this.res.getHeaders():this.res._headers||{}}get status(){return this.res.statusCode}set status(e){return u(R.isNumber(e),"status code must be a number"),u(x[e],`invalid status code: ${e}`),u(!this.res.headersSent,"headers have already been sent"),this._explicitStatus=!0,this.res.statusCode=e,this.res.statusMessage=x[e],Boolean(this.body&&x.empty[e])&&(this.body=null),e}get message(){return this.res.statusMessage||x[this.status]}set message(e){return this.res.statusMessage=e,e}get body(){return this._body}set body(e){const t=this._body;if(this._body=e,this.res.headersSent)return;if(null==e)return x.empty[this.status]||(this.status=204),this.remove("Content-Type"),this.remove("Content-Length"),void this.remove("Transfer-Encoding");this._explicitStatus||(this.status=200);const r=!this.headers["content-type"];return R.isString(e)?(r&&(this.type=/^\s*</.test(e)?"html":"text"),void(this.length=Buffer.byteLength(e))):R.isBuffer(e)?(r&&(this.type="bin"),void(this.length=e.length)):R.isFunction(e.pipe)?(g(this.res,m.bind(null,e)),f(e,(e=>this.ctx.onerror(e))),null!=t&&t!==e&&this.remove("Content-Length"),void(r&&(this.type="bin"))):(this.remove("Content-Length"),this.type="json",e)}get length(){const e=this.headers["content-length"];return null==e?this.body?R.isString(this.body)?Buffer.byteLength(this.body):R.isBuffer(this.body)?this.body.length:R.isObjectLike(this.body)?Buffer.byteLength(JSON.stringify(this.body)):0:0:~~Number(e)}set length(e){return this.set("Content-Length",e),e}get headerSent(){return this.res.headersSent}vary(e){O(this.res,e)}redirect(e,t){if("back"===e&&(e=this.ctx.get("Referrer")||t||"/"),this.set("Location",e),x.redirect[this.status]||(this.status=302),this.ctx.accepts("html"))return e=j(e),this.type="text/html; charset=utf-8",void(this.body=`Redirecting to <a href="${e}">#{url}</a>.`);this.type="text/plain; charset=utf-8",this.body=`Redirecting to ${e}`}attachment(e){null!=e&&(this.type=d.extname(e)),this.set("Content-Disposition",w(e))}get lastModified(){const e=this.get("last-modified");if(null!=e)return new Date(e)}set lastModified(e){return R.isString(e)&&(e=new Date(e)),this.set("Last-Modified",e.toUTCString()),e}get etag(){return this.get("ETag")}set etag(e){return/^(W\/)?"/.test(e)||(e=`"${e}"`),this.set("ETag",e),e}get type(){const e=this.get("Content-Type");return e?e.split(";")[0]:""}set type(e){const t=h.contentType(e);return t?this.set("Content-Type",t):this.remove("Content-Type"),e}is(...e){let[t]=e;return t?(R.isArray(t)||(t=e),n.is(this.type,t)):this.type||!1}get(e){return this.headers[e.toLowerCase()]||""}set(...e){const[t,r]=e;if(2===e.length)R.isArray(r)?this.res.setHeader(t,r.map(String)):this.res.setHeader(t,String(r));else for(const e in t)oe.call(t,e)&&this.set(e,t[e])}append(e,t){const r=this.get(e);null!=r&&""!==r&&(t=R.isArray(r)?r.concat(t):[r].concat(t)),this.set(e,t)}remove(e){this.res.removeHeader(e)}get writable(){if(this.res.finished)return!1;const e=this.res.socket;return null==e||e.writable}flushHeaders(){if(R.isFunction(this.res.flushHeaders))this.res.flushHeaders();else{const e=R.isFunction(this.res.getHeaderNames)?this.res.getHeaderNames():Object.keys(this.res._headers);for(const t of e)this.res.removeHeader(t)}}setContext(e){this.ctx=e}setRes(e){this._res=e}static async restoreObject(){u.fail(`restoreObject method not supported for ${this.name}`)}static async replicateObject(){u.fail(`replicateObject method not supported for ${this.name}`)}},a.__filename="/context/HttpResponse.js",a.object={},q(r=c,"__filename",[v],(o=(o=Object.getOwnPropertyDescriptor(r,"__filename"))?o.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return o}}),r),q(r,"object",[_],(i=(i=Object.getOwnPropertyDescriptor(r,"object"))?i.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return i}}),r),s=q(r.prototype,"_res",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q(r.prototype,"res",[D],Object.getOwnPropertyDescriptor(r.prototype,"res"),r.prototype),p=q(r.prototype,"ctx",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q(r.prototype,"socket",[D],Object.getOwnPropertyDescriptor(r.prototype,"socket"),r.prototype),q(r.prototype,"header",[D],Object.getOwnPropertyDescriptor(r.prototype,"header"),r.prototype),q(r.prototype,"headers",[D],Object.getOwnPropertyDescriptor(r.prototype,"headers"),r.prototype),q(r.prototype,"status",[D],Object.getOwnPropertyDescriptor(r.prototype,"status"),r.prototype),q(r.prototype,"status",[D],Object.getOwnPropertyDescriptor(r.prototype,"status"),r.prototype),q(r.prototype,"message",[D],Object.getOwnPropertyDescriptor(r.prototype,"message"),r.prototype),q(r.prototype,"message",[D],Object.getOwnPropertyDescriptor(r.prototype,"message"),r.prototype),q(r.prototype,"body",[D],Object.getOwnPropertyDescriptor(r.prototype,"body"),r.prototype),q(r.prototype,"body",[D],Object.getOwnPropertyDescriptor(r.prototype,"body"),r.prototype),q(r.prototype,"length",[D],Object.getOwnPropertyDescriptor(r.prototype,"length"),r.prototype),q(r.prototype,"length",[D],Object.getOwnPropertyDescriptor(r.prototype,"length"),r.prototype),q(r.prototype,"headerSent",[D],Object.getOwnPropertyDescriptor(r.prototype,"headerSent"),r.prototype),q(r.prototype,"vary",[P],Object.getOwnPropertyDescriptor(r.prototype,"vary"),r.prototype),q(r.prototype,"redirect",[P],Object.getOwnPropertyDescriptor(r.prototype,"redirect"),r.prototype),q(r.prototype,"attachment",[P],Object.getOwnPropertyDescriptor(r.prototype,"attachment"),r.prototype),q(r.prototype,"lastModified",[D],Object.getOwnPropertyDescriptor(r.prototype,"lastModified"),r.prototype),q(r.prototype,"lastModified",[D],Object.getOwnPropertyDescriptor(r.prototype,"lastModified"),r.prototype),q(r.prototype,"etag",[D],Object.getOwnPropertyDescriptor(r.prototype,"etag"),r.prototype),q(r.prototype,"etag",[D],Object.getOwnPropertyDescriptor(r.prototype,"etag"),r.prototype),q(r.prototype,"type",[D],Object.getOwnPropertyDescriptor(r.prototype,"type"),r.prototype),q(r.prototype,"type",[D],Object.getOwnPropertyDescriptor(r.prototype,"type"),r.prototype),q(r.prototype,"is",[P],Object.getOwnPropertyDescriptor(r.prototype,"is"),r.prototype),q(r.prototype,"get",[P],Object.getOwnPropertyDescriptor(r.prototype,"get"),r.prototype),q(r.prototype,"set",[P],Object.getOwnPropertyDescriptor(r.prototype,"set"),r.prototype),q(r.prototype,"append",[P],Object.getOwnPropertyDescriptor(r.prototype,"append"),r.prototype),q(r.prototype,"remove",[P],Object.getOwnPropertyDescriptor(r.prototype,"remove"),r.prototype),q(r.prototype,"writable",[D],Object.getOwnPropertyDescriptor(r.prototype,"writable"),r.prototype),q(r.prototype,"flushHeaders",[P],Object.getOwnPropertyDescriptor(r.prototype,"flushHeaders"),r.prototype),q(r.prototype,"setContext",[P],Object.getOwnPropertyDescriptor(r.prototype,"setContext"),r.prototype),q(r.prototype,"setRes",[P],Object.getOwnPropertyDescriptor(r.prototype,"setRes"),r.prototype),q(r,"restoreObject",[P],Object.getOwnPropertyDescriptor(r,"restoreObject"),r),q(r,"replicateObject",[P],Object.getOwnPropertyDescriptor(r,"replicateObject"),r),t=r))||t)||t)},se=e=>{var t,r,o,i,s,n,p,a,c,l;const{CoreObject:u,assert:y,initialize:h,partOf:d,meta:b,property:g,method:m,nameBy:O,injectable:f,Utils:{_:w}}=e.NS;h(t=f()(t=d(e)((l=c=class extends u{constructor(...e){super(...e),M(this,"_cookies",s,this),M(this,"req",n,this),M(this,"res",p,this),M(this,"key",a,this)}get(e,t){return this._cookies.get(e,t)}set(e,t,r){return this._cookies.set(e,t,r),this}static async restoreObject(){y.fail(`restoreObject method not supported for ${this.name}`)}static async replicateObject(){y.fail(`replicateObject method not supported for ${this.name}`)}setReqResOpts(e,t,r={}){const o=r.key||"secret",i=r.secure||!1;this.req=e,this.res=t,this.key=o;const s=new D([o],"sha256","hex");this._cookies=new P(e,t,{keys:s,secure:i})}},c.__filename="/context/HttpCookies.js",c.object={},q(r=l,"__filename",[O],(o=(o=Object.getOwnPropertyDescriptor(r,"__filename"))?o.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return o}}),r),q(r,"object",[b],(i=(i=Object.getOwnPropertyDescriptor(r,"object"))?i.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return i}}),r),s=q(r.prototype,"_cookies",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),n=q(r.prototype,"req",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=q(r.prototype,"res",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a=q(r.prototype,"key",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q(r.prototype,"get",[m],Object.getOwnPropertyDescriptor(r.prototype,"get"),r.prototype),q(r.prototype,"set",[m],Object.getOwnPropertyDescriptor(r.prototype,"set"),r.prototype),q(r,"restoreObject",[m],Object.getOwnPropertyDescriptor(r,"restoreObject"),r),q(r,"replicateObject",[m],Object.getOwnPropertyDescriptor(r,"replicateObject"),r),q(r.prototype,"setReqResOpts",[m],Object.getOwnPropertyDescriptor(r.prototype,"setReqResOpts"),r.prototype),t=r))||t)||t)},ne=e=>{var t,r,o,i,s,n,p,a,c,l,u,y,h,d,b,g,m,O,f,w,j,_,D,P,R,x,E;const{PRODUCTION:S,HTTP_MEDIATOR:z,CoreObject:T,assert:k,initialize:C,partOf:$,meta:L,property:I,method:A,nameBy:B,mixin:H,injectable:U,inject:F,Utils:{_:G,statuses:V}}=e.NS;t=U(),r=$(e),o=F(`Factory<${z}>`),i=F("HttpRequest"),s=F("HttpResponse"),n=F("HttpCookies"),C(p=t(p=r((E=x=class extends T{constructor(...e){super(...e),M(this,"_httpMediatorFactory",u,this),M(this,"request",y,this),M(this,"response",h,this),M(this,"cookies",d,this),M(this,"_req",b,this),M(this,"_res",g,this),M(this,"accept",m,this),M(this,"state",O,this),M(this,"respond",f,this),M(this,"routePath",w,this),M(this,"pathParams",j,this),M(this,"transaction",_,this),M(this,"session",D,this),M(this,"isPerformExecution",P,this),M(this,"originalUrl",R,this)}get _httpMediator(){return this._httpMediatorFactory()}get req(){return this._req}get res(){return this._res}throw(...e){throw N(...e)}assert(...e){return k(...e)}onerror(e){if(null==e)return;G.isError(e)||(e=new Error(`non-error thrown: ${e}`));const t=e.headerSent=!(!this.headerSent&&this.writable);if(this._httpMediator.getViewComponent().emit("error",e,this),t)return;G.isFunction(this.res.getHeaderNames)&&this.res.getHeaderNames().forEach((e=>{this.res.removeHeader(e)}));Object.keys(this.res.headers||{}).forEach((e=>{this.res.removeHeader(e),delete this.res.headers[e]})),this.set(e.headers||{}),this.type="text","ENOENT"===e.code&&(e.status=404),G.isNumber(e.status)&&V[e.status]||(e.status=500);const r=V[e.status],o=e.expose?e.message:r,i={error:!0,errorNum:e.status,errorMessage:o,code:e.code||r};null!=this.configs&&this.configs.environment===S||(i.exception=`${e.name||"Error"}: ${o}`,i.stacktrace=e.stack.split("\n")),this.status=e.status;const s=JSON.stringify(i);this.length=Buffer.byteLength(s),this.res.end(s)}get header(){return this.request.header}get headers(){return this.request.headers}get method(){return this.request.method}set method(e){return this.request.method=e}get url(){return this.request.url}set url(e){return this.request.url=e}get origin(){return this.request.origin}get href(){return this.request.href}get path(){return this.request.path}set path(e){return this.request.path=e}get query(){return this.request.query}set query(e){return this.request.query=e}get querystring(){return this.request.querystring}set querystring(e){return this.request.querystring=e}get host(){return this.request.host}get hostname(){return this.request.hostname}get fresh(){return this.request.fresh}get stale(){return this.request.stale}get socket(){return this.request.socket}get protocol(){return this.request.protocol}get secure(){return this.request.secure}get ip(){return this.request.ip}get ips(){return this.request.ips}get subdomains(){return this.request.subdomains}is(...e){return this.request.is(...e)}accepts(...e){return this.request.accepts(...e)}acceptsEncodings(...e){return this.request.acceptsEncodings(...e)}acceptsCharsets(...e){return this.request.acceptsCharsets(...e)}acceptsLanguages(...e){return this.request.acceptsLanguages(...e)}get(...e){return this.request.get(...e)}get body(){return this.response.body}set body(e){return this.response.body=e}get status(){return this.response.status}set status(e){return this.response.status=e}get message(){return this.response.message}set message(e){return this.response.message=e}get length(){return this.response.length}set length(e){return this.response.length=e}get writable(){return this.response.writable}get type(){return this.response.type}set type(e){return this.response.type=e}get headerSent(){return this.response.headerSent}redirect(...e){return this.response.redirect(...e)}attachment(...e){return this.response.attachment(...e)}set(...e){return this.response.set(...e)}append(...e){return this.response.append(...e)}vary(...e){return this.response.vary(...e)}flushHeaders(...e){return this.response.flushHeaders(...e)}remove(...e){return this.response.remove(...e)}set lastModified(e){return this.response.lastModified=e}set etag(e){return this.response.etag=e}setReqResPair(e,t){this._req=e,this._res=t,this.originalUrl=e.url,this.accept=v(e),this.request.setContext(this),this.request.setReq(e),this.response.setContext(this),this.response.setRes(t),this.state={};const r=null!=this.configs&&this.configs.cookieKey||"secret",o=e.secure;this.cookies.setReqResOpts(e,t,{key:r,secure:o})}static async restoreObject(){k.fail(`restoreObject method not supported for ${this.name}`)}static async replicateObject(){k.fail(`replicateObject method not supported for ${this.name}`)}},x.__filename="/context/Context.js",x.object={},q(a=E,"__filename",[B],(c=(c=Object.getOwnPropertyDescriptor(a,"__filename"))?c.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return c}}),a),q(a,"object",[L],(l=(l=Object.getOwnPropertyDescriptor(a,"object"))?l.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return l}}),a),u=q(a.prototype,"_httpMediatorFactory",[o,I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q(a.prototype,"_httpMediator",[I],Object.getOwnPropertyDescriptor(a.prototype,"_httpMediator"),a.prototype),y=q(a.prototype,"request",[i,I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=q(a.prototype,"response",[s,I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=q(a.prototype,"cookies",[n,I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=q(a.prototype,"_req",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=q(a.prototype,"_res",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q(a.prototype,"req",[I],Object.getOwnPropertyDescriptor(a.prototype,"req"),a.prototype),q(a.prototype,"res",[I],Object.getOwnPropertyDescriptor(a.prototype,"res"),a.prototype),m=q(a.prototype,"accept",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=q(a.prototype,"state",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=q(a.prototype,"respond",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=q(a.prototype,"routePath",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=q(a.prototype,"pathParams",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=q(a.prototype,"transaction",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=q(a.prototype,"session",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=q(a.prototype,"isPerformExecution",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),q(a.prototype,"throw",[A],Object.getOwnPropertyDescriptor(a.prototype,"throw"),a.prototype),q(a.prototype,"assert",[A],Object.getOwnPropertyDescriptor(a.prototype,"assert"),a.prototype),q(a.prototype,"onerror",[A],Object.getOwnPropertyDescriptor(a.prototype,"onerror"),a.prototype),q(a.prototype,"header",[I],Object.getOwnPropertyDescriptor(a.prototype,"header"),a.prototype),q(a.prototype,"headers",[I],Object.getOwnPropertyDescriptor(a.prototype,"headers"),a.prototype),q(a.prototype,"method",[I],Object.getOwnPropertyDescriptor(a.prototype,"method"),a.prototype),q(a.prototype,"method",[I],Object.getOwnPropertyDescriptor(a.prototype,"method"),a.prototype),q(a.prototype,"url",[I],Object.getOwnPropertyDescriptor(a.prototype,"url"),a.prototype),q(a.prototype,"url",[I],Object.getOwnPropertyDescriptor(a.prototype,"url"),a.prototype),R=q(a.prototype,"originalUrl",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q(a.prototype,"origin",[I],Object.getOwnPropertyDescriptor(a.prototype,"origin"),a.prototype),q(a.prototype,"href",[I],Object.getOwnPropertyDescriptor(a.prototype,"href"),a.prototype),q(a.prototype,"path",[I],Object.getOwnPropertyDescriptor(a.prototype,"path"),a.prototype),q(a.prototype,"path",[I],Object.getOwnPropertyDescriptor(a.prototype,"path"),a.prototype),q(a.prototype,"query",[I],Object.getOwnPropertyDescriptor(a.prototype,"query"),a.prototype),q(a.prototype,"query",[I],Object.getOwnPropertyDescriptor(a.prototype,"query"),a.prototype),q(a.prototype,"querystring",[I],Object.getOwnPropertyDescriptor(a.prototype,"querystring"),a.prototype),q(a.prototype,"querystring",[I],Object.getOwnPropertyDescriptor(a.prototype,"querystring"),a.prototype),q(a.prototype,"host",[I],Object.getOwnPropertyDescriptor(a.prototype,"host"),a.prototype),q(a.prototype,"hostname",[I],Object.getOwnPropertyDescriptor(a.prototype,"hostname"),a.prototype),q(a.prototype,"fresh",[I],Object.getOwnPropertyDescriptor(a.prototype,"fresh"),a.prototype),q(a.prototype,"stale",[I],Object.getOwnPropertyDescriptor(a.prototype,"stale"),a.prototype),q(a.prototype,"socket",[I],Object.getOwnPropertyDescriptor(a.prototype,"socket"),a.prototype),q(a.prototype,"protocol",[I],Object.getOwnPropertyDescriptor(a.prototype,"protocol"),a.prototype),q(a.prototype,"secure",[I],Object.getOwnPropertyDescriptor(a.prototype,"secure"),a.prototype),q(a.prototype,"ip",[I],Object.getOwnPropertyDescriptor(a.prototype,"ip"),a.prototype),q(a.prototype,"ips",[I],Object.getOwnPropertyDescriptor(a.prototype,"ips"),a.prototype),q(a.prototype,"subdomains",[I],Object.getOwnPropertyDescriptor(a.prototype,"subdomains"),a.prototype),q(a.prototype,"is",[A],Object.getOwnPropertyDescriptor(a.prototype,"is"),a.prototype),q(a.prototype,"accepts",[A],Object.getOwnPropertyDescriptor(a.prototype,"accepts"),a.prototype),q(a.prototype,"acceptsEncodings",[A],Object.getOwnPropertyDescriptor(a.prototype,"acceptsEncodings"),a.prototype),q(a.prototype,"acceptsCharsets",[A],Object.getOwnPropertyDescriptor(a.prototype,"acceptsCharsets"),a.prototype),q(a.prototype,"acceptsLanguages",[A],Object.getOwnPropertyDescriptor(a.prototype,"acceptsLanguages"),a.prototype),q(a.prototype,"get",[A],Object.getOwnPropertyDescriptor(a.prototype,"get"),a.prototype),q(a.prototype,"body",[I],Object.getOwnPropertyDescriptor(a.prototype,"body"),a.prototype),q(a.prototype,"body",[I],Object.getOwnPropertyDescriptor(a.prototype,"body"),a.prototype),q(a.prototype,"status",[I],Object.getOwnPropertyDescriptor(a.prototype,"status"),a.prototype),q(a.prototype,"status",[I],Object.getOwnPropertyDescriptor(a.prototype,"status"),a.prototype),q(a.prototype,"message",[I],Object.getOwnPropertyDescriptor(a.prototype,"message"),a.prototype),q(a.prototype,"message",[I],Object.getOwnPropertyDescriptor(a.prototype,"message"),a.prototype),q(a.prototype,"length",[I],Object.getOwnPropertyDescriptor(a.prototype,"length"),a.prototype),q(a.prototype,"length",[I],Object.getOwnPropertyDescriptor(a.prototype,"length"),a.prototype),q(a.prototype,"writable",[I],Object.getOwnPropertyDescriptor(a.prototype,"writable"),a.prototype),q(a.prototype,"type",[I],Object.getOwnPropertyDescriptor(a.prototype,"type"),a.prototype),q(a.prototype,"type",[I],Object.getOwnPropertyDescriptor(a.prototype,"type"),a.prototype),q(a.prototype,"headerSent",[I],Object.getOwnPropertyDescriptor(a.prototype,"headerSent"),a.prototype),q(a.prototype,"redirect",[A],Object.getOwnPropertyDescriptor(a.prototype,"redirect"),a.prototype),q(a.prototype,"attachment",[A],Object.getOwnPropertyDescriptor(a.prototype,"attachment"),a.prototype),q(a.prototype,"set",[A],Object.getOwnPropertyDescriptor(a.prototype,"set"),a.prototype),q(a.prototype,"append",[A],Object.getOwnPropertyDescriptor(a.prototype,"append"),a.prototype),q(a.prototype,"vary",[A],Object.getOwnPropertyDescriptor(a.prototype,"vary"),a.prototype),q(a.prototype,"flushHeaders",[A],Object.getOwnPropertyDescriptor(a.prototype,"flushHeaders"),a.prototype),q(a.prototype,"remove",[A],Object.getOwnPropertyDescriptor(a.prototype,"remove"),a.prototype),q(a.prototype,"lastModified",[I],Object.getOwnPropertyDescriptor(a.prototype,"lastModified"),a.prototype),q(a.prototype,"etag",[I],Object.getOwnPropertyDescriptor(a.prototype,"etag"),a.prototype),q(a.prototype,"setReqResPair",[A],Object.getOwnPropertyDescriptor(a.prototype,"setReqResPair"),a.prototype),q(a,"restoreObject",[A],Object.getOwnPropertyDescriptor(a,"restoreObject"),a),q(a,"replicateObject",[A],Object.getOwnPropertyDescriptor(a,"replicateObject"),a),p=a))||p)||p)},pe=e=>{var t,r,o,i,s,n,p,a,c,l;const{CoreObject:u,initialize:y,partOf:h,meta:d,method:b,nameBy:g,property:m,injectable:O,inject:f}=e.NS;t=O(),r=h(e),o=f("ApplicationModule"),y(i=t(i=r((l=c=class extends u{constructor(...e){super(...e),M(this,"_ApplicationModule",a,this)}get ApplicationModule(){return this._ApplicationModule}async render(e,t,r,o={}){const{path:i,resource:s,action:n,template:p}=o;if(null!=i&&null!=s&&null!=n){const{Templates:e}=this.ApplicationModule.NS;return await Promise.resolve().then((()=>null==e||null==e[p]?t:e[p].call(r,s,n,t)||t))}return t}},c.__filename="/renderer/Renderer.js",c.object={},q(s=l,"__filename",[g],(n=(n=Object.getOwnPropertyDescriptor(s,"__filename"))?n.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return n}}),s),q(s,"object",[d],(p=(p=Object.getOwnPropertyDescriptor(s,"object"))?p.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return p}}),s),a=q(s.prototype,"_ApplicationModule",[o,m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q(s.prototype,"ApplicationModule",[m],Object.getOwnPropertyDescriptor(s.prototype,"ApplicationModule"),s.prototype),q(s.prototype,"render",[b],Object.getOwnPropertyDescriptor(s.prototype,"render"),s.prototype),i=s))||i)||i)};const ae=[].slice,ce={}.hasOwnProperty;var le=e=>{var t,r,o,i,s,n,p,a,c,l,u,y,h,d,b,g,m,O,f,w,j;const{Proxy:_,Proto:D,assert:P,initialize:v,partOf:N,meta:R,property:x,method:E,nameBy:S,mixin:z,Utils:{_:T,inflect:k}}=e.NS;v(t=N(e)((j=w=class e extends _{get path(){return this._path}get name(){return this._resource||this._name}get above(){return this._above}get tag(){return this._tag}get templates(){return this._templates}get param(){return this._param}defaultEntityName(){const e=this._name.replace(/\/$/,"").split("/"),[t]=ae.call(e,-1);return k.singularize(t)}map(){}externals(){return[]}root(e){}defineMethod(e,t,r,o={}){let{to:i,at:s,resource:n,action:p,tag:a,template:c,keyName:l,entityName:u,recordName:y}=o;P(null!=r,"path is required"),r=r.replace(/^[\/]/,""),null!=i&&(P(/[#]/.test(i),"`to` must be in format `<resource>#<action>`"),[n,p]=i.split("#"));const h=this._resource;null==n&&""!==h&&(n=h);const d=this._name;null==n&&""!==d&&(n=d),P(null!=n,"options `to` or `resource` must be defined"),null==p&&(p=r),/[\/]$/.test(n)||(n+="/"),null==l&&(l=null!=this._param?this._param.replace(/^\:/,""):void 0),null==u&&(u=this.defaultEntityName()),T.isString(y)||T.isNull(y)||(y=this.defaultEntityName());const b=`${null!=this._tag&&""!==this._tag?this._tag:""}${null!=a&&""!==a?`/${a}`:""}`;r=(()=>{switch(s||this._at){case"member":return`${this._path}:${k.singularize(k.underscore(n.replace(/[\/]/g,"_").replace(/[_]$/g,"")))}/${r}`;case"collection":default:return`${this._path}${r}`}})(),null==c&&(c=n+p),e.push({method:t,path:r,resource:n,action:p,tag:b,template:c,keyName:l,entityName:u,recordName:y})}get(e,t){this.defineMethod(this._pathes,"get",e,t)}post(e,t){this.defineMethod(this._pathes,"post",e,t)}put(e,t){this.defineMethod(this._pathes,"put",e,t)}delete(e,t){this.defineMethod(this._pathes,"delete",e,t)}head(e,t){this.defineMethod(this._pathes,"head",e,t)}options(e,t){this.defineMethod(this._pathes,"options",e,t)}patch(e,t){this.defineMethod(this._pathes,"patch",e,t)}resource(t,r=null,o=null){var i,s,n,p,a,c,l,u,y,h,d,b,g,m,O,f,w;const j=this.Module;T.isFunction(r)&&(o=r,r={}),null==r&&(r={}),null==o&&(o=()=>{});let{path:_,module:P,only:v,via:z,except:C,tag:$,templates:L,param:I,at:A,resource:B,above:H}=r;_=null!=_?_.replace(/^[\/]/,""):void 0;const U=null!=_&&""!==_?`${_}/`:null!=_&&""===_?"":`${t}/`,F=(()=>{switch(A||this._at){case"member":const e=this._path.split("/"),[t,r]=ae.call(e,-2);return`${this._path}:${k.singularize(k.underscore(t))}/${U}`;case"collection":default:return`${this._path}${U}`}})(),G=this._name,V=null!=this._templates&&""!==this._templates?`${this._templates}/`:"",J=null!=this._tag&&""!==this._tag?this._tag:"",Q=null!=P&&""!==P?`${P}/`:null!=P&&""===P?"":`${t}/`,W=null!=L&&""!==L?L:null!=L&&""===L?"":null!=P&&""!==P?P:null!=P&&""===P?"":t,X=null!=$&&""!==$?`/${$}`:"",K=null!=I&&""!==I?I:":"+k.singularize(k.underscore((null!=B?B:`${G}${Q}`).replace(/[\/]/g,"_").replace(/[_]$/g,"")));let Y=N(j)((w=f=class extends e{constructor(...e){super(...e),M(this,"_path",a,this),M(this,"_name",c,this),M(this,"_module",l,this),M(this,"_only",u,this),M(this,"_via",y,this),M(this,"_except",h,this),M(this,"_above",d,this),M(this,"_tag",b,this),M(this,"_templates",g,this),M(this,"_param",m,this),M(this,"_resource",O,this)}map(){return o.call(this)}},f.__filename="ResourceRouter",f.object={},q(s=w,"__filename",[S],(n=(n=Object.getOwnPropertyDescriptor(s,"__filename"))?n.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return n}}),s),q(s,"object",[R],(p=(p=Object.getOwnPropertyDescriptor(s,"object"))?p.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return p}}),s),a=q(s.prototype,"_path",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return F}}),c=q(s.prototype,"_name",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return`${G}${Q}`}}),l=q(s.prototype,"_module",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return P}}),u=q(s.prototype,"_only",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return v}}),y=q(s.prototype,"_via",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return z}}),h=q(s.prototype,"_except",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return C}}),d=q(s.prototype,"_above",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return H}}),b=q(s.prototype,"_tag",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return`${J}${X}`}}),g=q(s.prototype,"_templates",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return`${V}${W}`.replace(/[\/][\/]/g,"/")}}),m=q(s.prototype,"_param",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return K}}),O=q(s.prototype,"_resource",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return B}}),q(s.prototype,"map",[E],Object.getOwnPropertyDescriptor(s.prototype,"map"),s.prototype),i=s))||i;Y.constructor=D,Y.onInitialize(),this._routers.push(Y);const Z=Y.new();Z.defineValues(),this._resources.push(Z)}namespace(t,r=null,o=null){var i,s,n,p,a,c,l,u,y,h,d,b,g;const m=this.Module;T.isFunction(r)&&(o=r,r={}),null==r&&(r={});const{module:O,prefix:f,tag:w,templates:j,at:_,above:P}=r,v=this._path,z=null!=f&&""!==f?`${f}/`:null!=f&&""===f?"":`${t}/`,k=this._name,C=null!=this._templates&&""!==this._templates?`${this._templates}/`:"",$=null!=this._tag&&""!==this._tag?this._tag:"",L=null!=O&&""!==O?`${O}/`:null!=O&&""===O?"":`${t}/`,I=null!=j&&""!==j?j:null!=j&&""===j?"":null!=O&&""!==O?O:null!=O&&""===O?"":t,A=null!=w&&""!==w?`/${w}`:"";let B=N(m)((g=b=class extends e{constructor(...e){super(...e),M(this,"_path",a,this),M(this,"_name",c,this),M(this,"_except",l,this),M(this,"_tag",u,this),M(this,"_templates",y,this),M(this,"_at",h,this),M(this,"_above",d,this)}map(){return o.call(this)}},b.__filename="NamespaceRouter",b.object={},q(s=g,"__filename",[S],(n=(n=Object.getOwnPropertyDescriptor(s,"__filename"))?n.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return n}}),s),q(s,"object",[R],(p=(p=Object.getOwnPropertyDescriptor(s,"object"))?p.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return p}}),s),a=q(s.prototype,"_path",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return`${v}${z}`}}),c=q(s.prototype,"_name",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return`${k}${L}`}}),l=q(s.prototype,"_except",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return["all"]}}),u=q(s.prototype,"_tag",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return`${$}${A}`}}),y=q(s.prototype,"_templates",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return`${C}${I}`.replace(/[\/][\/]/g,"/")}}),h=q(s.prototype,"_at",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _}}),d=q(s.prototype,"_above",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return P}}),q(s.prototype,"map",[E],Object.getOwnPropertyDescriptor(s.prototype,"map"),s.prototype),i=s))||i;B.constructor=D,B.onInitialize(),this._routers.push(B);const H=B.new();H.defineValues(),this._resources.push(H)}member(e){this.namespace(null,{module:"",prefix:"",templates:"",at:"member"},e)}collection(e){this.namespace(null,{module:"",prefix:"",templates:"",at:"collection"},e)}get resources(){const e=[];return(this._resources||[]).forEach((t=>{e.push(t)})),null!=this._resources&&this._resources.forEach((t=>{(t.resources||[]).forEach((t=>{e.push(t)}))})),e}get routes(){const e=[];return(this._pathes||[]).forEach((t=>{e.push(t)})),null!=this._resources&&this._resources.forEach((t=>{(t.routes||[]).forEach((t=>{e.push(t)}))})),e}constructor(){super(...arguments),M(this,"_path",s,this),M(this,"_name",n,this),M(this,"_module",p,this),M(this,"_only",a,this),M(this,"_via",c,this),M(this,"_except",l,this),M(this,"_above",u,this),M(this,"_at",y,this),M(this,"_resource",h,this),M(this,"_tag",d,this),M(this,"_templates",b,this),M(this,"_param",g,this),M(this,"_routers",m,this),M(this,"_pathes",O,this),M(this,"_resources",f,this)}onRegister(){super.onRegister(...arguments),this.defineValues()}onRemove(){super.onRemove(...arguments)}defineValues(){for(const e of this.externals())for(const t of e.routes)this._pathes.push(t);this.map(),T.isString(this._only)&&(this._only=[this._only]),T.isString(this._via)&&(this._via=[this._via]),T.isString(this._except)&&(this._except=[this._except]);const e={list:"get",detail:"get",create:"post",update:"put",delete:"delete"},t={list:"",detail:null,create:"",update:null,delete:null};if(null!=this._name&&""!==this._name){const r=this._param&&this._param.replace(/^\:/,"")||void 0,o=this._above&&this._above.entityName||this.defaultEntityName(),i=this._above&&this._above.recordName||void 0,s=T.isNil(i)&&!T.isNull(i)?this.defaultEntityName():i;if(null!=this._only)this._only.forEach((i=>{const n=null!=t[i]?t[i]:this._param;this.defineMethod(this._pathes,e[i],n,{action:i,resource:this._resource||this._name,template:this._templates+"/"+i,keyName:r,entityName:o,recordName:s})}));else if(null!=this._except)for(const i in e){if(!ce.call(e,i))continue;const n=e[i];if(!this._except.includes("all")&&!this._except.includes(i)){const e=null!=t[i]?t[i]:this._param;this.defineMethod(this._pathes,n,e,{action:i,resource:this._resource||this._name,template:this._templates+"/"+i,keyName:r,entityName:o,recordName:s})}}else if(null!=this._via)this._via.forEach((i=>{const n=null!=t[i]?t[i]:this._param;if("all"===i)for(const t in e){if(!ce.call(e,t))continue;const i=e[t];this.defineMethod(this._pathes,i,n,{action:t,resource:this._resource||this._name,template:this._templates+"/"+t,keyName:r,entityName:o,recordName:s})}else this.defineMethod(this._pathes,e[i],n,{action:i,resource:this._resource||this._name,template:this._templates+"/"+asAction,keyName:r,entityName:o,recordName:s})}));else for(const i in e){if(!ce.call(e,i))continue;const n=e[i],p=null!=t[i]?t[i]:this._param;this.defineMethod(this._pathes,n,p,{action:i,resource:this._resource||this._name,template:this._templates+"/"+i,keyName:r,entityName:o,recordName:s})}}}},w.__filename="/proxies/Router.js",w.object={},q(r=j,"__filename",[S],(o=(o=Object.getOwnPropertyDescriptor(r,"__filename"))?o.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return o}}),r),q(r,"object",[R],(i=(i=Object.getOwnPropertyDescriptor(r,"object"))?i.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return i}}),r),s=q(r.prototype,"_path",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"/"}}),n=q(r.prototype,"_name",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),p=q(r.prototype,"_module",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a=q(r.prototype,"_only",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),c=q(r.prototype,"_via",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),l=q(r.prototype,"_except",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=q(r.prototype,"_above",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=q(r.prototype,"_at",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=q(r.prototype,"_resource",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=q(r.prototype,"_tag",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=q(r.prototype,"_templates",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=q(r.prototype,"_param",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=q(r.prototype,"_routers",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),O=q(r.prototype,"_pathes",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f=q(r.prototype,"_resources",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),q(r.prototype,"path",[x],Object.getOwnPropertyDescriptor(r.prototype,"path"),r.prototype),q(r.prototype,"name",[x],Object.getOwnPropertyDescriptor(r.prototype,"name"),r.prototype),q(r.prototype,"above",[x],Object.getOwnPropertyDescriptor(r.prototype,"above"),r.prototype),q(r.prototype,"tag",[x],Object.getOwnPropertyDescriptor(r.prototype,"tag"),r.prototype),q(r.prototype,"templates",[x],Object.getOwnPropertyDescriptor(r.prototype,"templates"),r.prototype),q(r.prototype,"param",[x],Object.getOwnPropertyDescriptor(r.prototype,"param"),r.prototype),q(r.prototype,"defaultEntityName",[E],Object.getOwnPropertyDescriptor(r.prototype,"defaultEntityName"),r.prototype),q(r.prototype,"map",[E],Object.getOwnPropertyDescriptor(r.prototype,"map"),r.prototype),q(r.prototype,"externals",[E],Object.getOwnPropertyDescriptor(r.prototype,"externals"),r.prototype),q(r.prototype,"root",[E],Object.getOwnPropertyDescriptor(r.prototype,"root"),r.prototype),q(r.prototype,"defineMethod",[E],Object.getOwnPropertyDescriptor(r.prototype,"defineMethod"),r.prototype),q(r.prototype,"get",[E],Object.getOwnPropertyDescriptor(r.prototype,"get"),r.prototype),q(r.prototype,"post",[E],Object.getOwnPropertyDescriptor(r.prototype,"post"),r.prototype),q(r.prototype,"put",[E],Object.getOwnPropertyDescriptor(r.prototype,"put"),r.prototype),q(r.prototype,"delete",[E],Object.getOwnPropertyDescriptor(r.prototype,"delete"),r.prototype),q(r.prototype,"head",[E],Object.getOwnPropertyDescriptor(r.prototype,"head"),r.prototype),q(r.prototype,"options",[E],Object.getOwnPropertyDescriptor(r.prototype,"options"),r.prototype),q(r.prototype,"patch",[E],Object.getOwnPropertyDescriptor(r.prototype,"patch"),r.prototype),q(r.prototype,"resource",[E],Object.getOwnPropertyDescriptor(r.prototype,"resource"),r.prototype),q(r.prototype,"namespace",[E],Object.getOwnPropertyDescriptor(r.prototype,"namespace"),r.prototype),q(r.prototype,"member",[E],Object.getOwnPropertyDescriptor(r.prototype,"member"),r.prototype),q(r.prototype,"collection",[E],Object.getOwnPropertyDescriptor(r.prototype,"collection"),r.prototype),q(r.prototype,"resources",[x],Object.getOwnPropertyDescriptor(r.prototype,"resources"),r.prototype),q(r.prototype,"routes",[x],Object.getOwnPropertyDescriptor(r.prototype,"routes"),r.prototype),q(r.prototype,"onRegister",[E],Object.getOwnPropertyDescriptor(r.prototype,"onRegister"),r.prototype),q(r.prototype,"onRemove",[E],Object.getOwnPropertyDescriptor(r.prototype,"onRemove"),r.prototype),q(r.prototype,"defineValues",[E],Object.getOwnPropertyDescriptor(r.prototype,"defineValues"),r.prototype),t=r))||t)};const ue=[].indexOf,ye=e=>{if(e)return decodeURIComponent(e)};var he=e=>{var t,r,o,i,s,n,p,a,c,l,u,y,h,d,b,m,O,f,w,j,_,D,P,v;const{APPLICATION_ROUTER:N,RESOURCE_RESULT:R,NON_RENDERABLE:T,METHODS:k,JSON_RENDERER:C,Pipes:$,Mediator:L,initialize:I,partOf:A,meta:B,property:H,method:U,nameBy:F,inject:G,Utils:{_:V,inflect:J,genRandomAlphaNumbers:Q,statuses:W,assert:X}}=e.NS;let K=(t=A(e),r=G("Factory<Context>"),o=G("RendererFactory<*>"),i=G("RouterFactory<*>"),s=G("ResourceChecker<*>"),I(n=t((v=P=class extends L{get responseFormats(){return["json","html","xml","atom","text"]}static compose(e,t){return X(V.isArray(e),"Middleware stack must be an array!"),X(V.isArray(t),"Handlers stack must be an array!"),async r=>{for(const t of e)X(V.isFunction(t),"Middleware must be composed of functions!"),await t(r);let o=!1;for(const e of t)if(null!=e){for(const t of e)if(X(V.isFunction(t),"Handler must be composed of functions!"),await t(r)){o=!0;break}if(o)break}}}static createMethod(t){const r=t||"all";t&&(t=t.toUpperCase()),Reflect.defineProperty(this.prototype,`${r}`,U(this.prototype,`${r}`,{value:function(r,o){X(!!o,"handler is required");const{ERROR:i,DEBUG:s,LEVELS:n,SEND_TO_LOG:p}=e.NS.Pipes.NS.LogMessage,a=[],c=x(r,a);this.send(p,`${null!=t?t:"ALL"} ${r} -> ${c}`,n[s]),this.use(a.length,(async e=>{if(!((e,t)=>!t||e.method===t||"GET"===t&&"HEAD"===e.method)(e,t))return;const i=c.exec(e.path);if(i){const t=i.slice(1).map(ye).reduce(((e,t,r)=>(e[a[r].name]=t,e)),{});return e.routePath=r,this.send(p,`${e.method} ${r} matches ${e.path} ${JSON.stringify(t)}`,n[s]),e.pathParams=t,await o.call(this,e)}}))}}))}del(...e){return this.delete(...e)}listNotificationInterests(){return[R]}handleNotification(e){const t=e.getName(),r=e.getBody(),o=e.getType();switch(t){case R:this.getViewComponent().emit(o,r)}}onRegister(){const e=new E;if(e.setMaxListeners(Number.MAX_SAFE_INTEGER),!V.isFunction(e.eventNames)){const t=this._eventNames={},r=["newListener","removeListener"];e.on("newListener",((e,o)=>{ue.call(r,e)<0&&(null==t[e]&&(t[e]=0),++t[e])})),e.on("removeListener",((e,o)=>{ue.call(r,e)<0&&t[e]>0&&--t[e]}))}0===e.listeners("error").length&&e.on("error",this.onerror.bind(this)),this.setViewComponent(e),this.defineRoutes(),this.serverListen()}async onRemove(){const e=this.getViewComponent();("function"==typeof e.eventNames?e.eventNames():Object.keys(this._eventNames||{})).forEach((t=>{e.removeAllListeners(t)})),await new Promise((e=>this._httpServer.close(e))),console.log("after HttpMediator::onRemove",this._multitonKey)}serverListen(){const{ERROR:t,DEBUG:r,LEVELS:o,SEND_TO_LOG:i}=e.NS.Pipes.NS.LogMessage,s="undefined"!=typeof process&&null!=process&&null!=process.env&&null!=process.env.PORT?process.env.PORT:null!=this.configs?this.configs.port:3e3;this._httpServer=S.createServer(this.callback()),this._httpServer.listen(s,(()=>{this.send(i,`listening on port ${s}`,o[r])}))}use(t,r){null==r&&(r=t,t=null),X(V.isFunction(r),"middleware or handler must be a function!");const o=r.name||"-",{ERROR:i,DEBUG:s,LEVELS:n,SEND_TO_LOG:p}=e.NS.Pipes.NS.LogMessage;return this.send(p,`use ${o}`,n[s]),null!=t?(null==this.handlers[t]&&(this.handlers[t]=[]),this.handlers[t].push(r)):this.middlewares.push(r),this}callback(){this._composed=this.constructor.compose(this.middlewares,this.handlers);const t=this._composed;return async(r,o)=>{const i=Date.now(),{ERROR:s,DEBUG:n,LEVELS:p,SEND_TO_LOG:a}=e.NS.Pipes.NS.LogMessage;this.send(a,">>>>>> START REQUEST HANDLING",p[n]),o.statusCode=404;const c=this._contextFactory();c.setReqResPair(r,o);try{await t(c),this.respond(c)}catch(e){c.onerror(e)}g(o,(e=>{c.onerror(e)})),this.send(a,">>>>>> END REQUEST HANDLING",p[n]);const l=c.request.length,u=c.response.length,y=Date.now()-i;await this.handleStatistics(l,u,y,c)}}async handleStatistics(t,r,o,i){const{DEBUG:s,LEVELS:n,SEND_TO_LOG:p}=e.NS.Pipes.NS.LogMessage;this.send(p,`REQUEST LENGTH ${t} byte RESPONSE LENGTH ${r} byte HANDLED BY ${o} ms`,n[s])}onerror(t){if(X(V.isError(t),`non-error thrown: ${t}`),404===t.status||t.expose)return;if(null!=this.configs&&this.configs.silent)return;const r=t.stack||String(t),{ERROR:o,DEBUG:i,LEVELS:s,SEND_TO_LOG:n}=e.NS.Pipes.NS.LogMessage;this.send(n,r.replace(/^/gm,"  "),s[o])}respond(e){if(!1===e.respond)return;let t=e.body;const r=e.status;return W.empty[r]?(e.body=null,void e.res.end()):"HEAD"===e.method?(!e.headersSent&&V.isObjectLike(t)&&(e.length=Buffer.byteLength(JSON.stringify(t))),void e.res.end()):null==t?(t=e.message||String(r),e.headersSent||(e.type="text",e.length=Buffer.byteLength(t)),void e.res.end(t)):void(V.isBuffer(t)||V.isString(t)?e.res.end(t):t instanceof z?t.pipe(e.res):(t=JSON.stringify(null!=t?t:null),e.res.headersSent||(e.length=Buffer.byteLength(t)),e.res.end(t)))}async perform(e,t,r){this.send(SEND_TO_LOG,">>>>>> START PERFORM-REQUEST HANDLING",LEVELS[DEBUG]);const o=this.constructor.compose(this.middlewares,this.handlers),i={method:e,url:t,headers:r.headers};null!=r.body&&(i.body=r.data||r.body||r.form,i.rawBody=new Buffer(JSON.stringify(i.body)));const s={statusCode:404},n=this._contextFactory();n.setReqResPair(i,s),n.isPerformExecution=!0;try{await o(n),this.respond(n)}catch(e){n.onerror(e)}const{statusCode:p,statusMessage:a,body:c,headers:l}=s;return this.send(SEND_TO_LOG,">>>>>> END PERFORM-REQUEST HANDLING",LEVELS[DEBUG]),{status:p,message:a,headers:l,body:c}}rendererFor(e){return null!=this[`${e}RendererName`]?this._rendererFactory(this[`${e}RendererName`]):this._rendererFactory(this.jsonRendererName)}async sendHttpResponse(e,t,r,o){if(t===T)return;let i;if("create"===o.action&&(e.status=201),null!=(e.headers&&e.headers.accept||void 0)){const t=e.accepts(this.responseFormats);switch(t){case!1:break;default:null!=this[`${t}RendererName`]&&(i=this.rendererFor(t))}}else null!=this[`${this.defaultRenderer}RendererName`]&&(i=this.rendererFor(this.defaultRenderer));null!=i&&(e.body=await i.render(e,t,r,o))}defineRoutes(){this._routerFactory(this.routerName||N).routes.forEach((e=>this.createNativeRoute(e)))}sender(e,t,r){this._resourceChecker(e)?this.send(e,t,r.action):this.getViewComponent().emit(t.reverse,{error:null,result:null,resource:{}})}createNativeRoute(e){const{method:t,path:r}=e,o=J.camelize(J.underscore(`${e.resource.replace(/[\/]/g,"_")}Resource`));"function"==typeof this[t]&&this[t](r,(async t=>(await new Promise(((r,i)=>{try{const s=Q(32);this.getViewComponent().once(s,(async({error:o,result:s,resource:n})=>{if(null!=o)return console.log(">>>>>> ERROR AFTER RESOURCE",o),void i(o);try{await this.sendHttpResponse(t,s,n,e),r()}catch(e){i(e)}})),this.sender(o,{context:t,reverse:s},e)}catch(e){i(e)}})),!0)))}constructor(){super(...arguments),M(this,"_contextFactory",l,this),M(this,"_rendererFactory",u,this),M(this,"_routerFactory",y,this),M(this,"_resourceChecker",h,this),M(this,"_eventNames",d,this),M(this,"_httpServer",b,this),M(this,"_composed",m,this),M(this,"_handler",O,this),M(this,"middlewares",f,this),M(this,"handlers",w,this),M(this,"routerName",j,this),M(this,"defaultRenderer",_,this),M(this,"jsonRendererName",D,this),this.middlewares=[],this.handlers=[]}},P.__filename="/mediators/HttpMediator.js",P.object={},q(p=v,"__filename",[F],(a=(a=Object.getOwnPropertyDescriptor(p,"__filename"))?a.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return a}}),p),q(p,"object",[B],(c=(c=Object.getOwnPropertyDescriptor(p,"object"))?c.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return c}}),p),l=q(p.prototype,"_contextFactory",[r,H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=q(p.prototype,"_rendererFactory",[o,H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=q(p.prototype,"_routerFactory",[i,H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=q(p.prototype,"_resourceChecker",[s,H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=q(p.prototype,"_eventNames",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=q(p.prototype,"_httpServer",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=q(p.prototype,"_composed",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=q(p.prototype,"_handler",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=q(p.prototype,"middlewares",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=q(p.prototype,"handlers",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q(p.prototype,"responseFormats",[H],Object.getOwnPropertyDescriptor(p.prototype,"responseFormats"),p.prototype),j=q(p.prototype,"routerName",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return N}}),_=q(p.prototype,"defaultRenderer",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"json"}}),q(p,"compose",[U],Object.getOwnPropertyDescriptor(p,"compose"),p),q(p,"createMethod",[U],Object.getOwnPropertyDescriptor(p,"createMethod"),p),q(p.prototype,"del",[U],Object.getOwnPropertyDescriptor(p.prototype,"del"),p.prototype),D=q(p.prototype,"jsonRendererName",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return C}}),q(p.prototype,"listNotificationInterests",[U],Object.getOwnPropertyDescriptor(p.prototype,"listNotificationInterests"),p.prototype),q(p.prototype,"handleNotification",[U],Object.getOwnPropertyDescriptor(p.prototype,"handleNotification"),p.prototype),q(p.prototype,"onRegister",[U],Object.getOwnPropertyDescriptor(p.prototype,"onRegister"),p.prototype),q(p.prototype,"onRemove",[U],Object.getOwnPropertyDescriptor(p.prototype,"onRemove"),p.prototype),q(p.prototype,"serverListen",[U],Object.getOwnPropertyDescriptor(p.prototype,"serverListen"),p.prototype),q(p.prototype,"use",[U],Object.getOwnPropertyDescriptor(p.prototype,"use"),p.prototype),q(p.prototype,"callback",[U],Object.getOwnPropertyDescriptor(p.prototype,"callback"),p.prototype),q(p.prototype,"handleStatistics",[U],Object.getOwnPropertyDescriptor(p.prototype,"handleStatistics"),p.prototype),q(p.prototype,"onerror",[U],Object.getOwnPropertyDescriptor(p.prototype,"onerror"),p.prototype),q(p.prototype,"respond",[U],Object.getOwnPropertyDescriptor(p.prototype,"respond"),p.prototype),q(p.prototype,"perform",[U],Object.getOwnPropertyDescriptor(p.prototype,"perform"),p.prototype),q(p.prototype,"rendererFor",[U],Object.getOwnPropertyDescriptor(p.prototype,"rendererFor"),p.prototype),q(p.prototype,"sendHttpResponse",[U],Object.getOwnPropertyDescriptor(p.prototype,"sendHttpResponse"),p.prototype),q(p.prototype,"defineRoutes",[U],Object.getOwnPropertyDescriptor(p.prototype,"defineRoutes"),p.prototype),q(p.prototype,"sender",[U],Object.getOwnPropertyDescriptor(p.prototype,"sender"),p.prototype),q(p.prototype,"createNativeRoute",[U],Object.getOwnPropertyDescriptor(p.prototype,"createNativeRoute"),p.prototype),n=p))||n)||n);k.forEach((e=>{K.createMethod(e)})),K.createMethod()},de=e=>{var t,r,o,i,s,n,p,a,c,l,u,y,h,d;const{RESOURCE_RESULT:b,NON_OVERRIDDEN:g,Command:m,initialize:O,partOf:f,meta:w,property:j,method:_,nameBy:D,action:P,chains:v,inject:N,Utils:{_:R,inflect:x,assign:E,assert:S,statuses:z}}=e.NS,T=z("not found");t=v(["list","detail","create","update","delete","destroy"],(function(){this.initialHook("beforeActionHook"),this.beforeHook("getRecordId",{only:["detail","update","delete","destroy"]}),this.beforeHook("checkExistence",{only:["detail","update","delete","destroy"]}),this.beforeHook("getRecordBody",{only:["create","update"]}),this.beforeHook("omitBody",{only:["create","update"]}),this.beforeHook("beforeUpdate",{only:["update"]})})),r=f(e),o=N("CollectionFactory<*>"),O(i=t(i=r((d=h=class extends m{constructor(...e){super(...e),M(this,"_collectionFactory",a,this),M(this,"context",c,this),M(this,"recordId",l,this),M(this,"recordBody",u,this),M(this,"actionResult",y,this)}get entityName(){return g}async checkExistence(...e){return null==this.recordId&&this.context.throw(T),null==this.collection||await this.collection.includes(this.recordId)||this.context.throw(T),e}get keyName(){return this.entityName==g?"id":x.singularize(x.underscore(this.entityName))}get itemEntityName(){return this.entityName==g?"entity":x.singularize(x.underscore(this.entityName))}get listEntityName(){return this.entityName==g?"entities":x.pluralize(x.underscore(this.entityName))}get collectionName(){return this.entityName==g?null:`${x.pluralize(x.camelize(this.entityName))}Collection`}get collection(){return this.entityName==g?null:this._collectionFactory(this.collectionName)}static get actions(){return this.metaObject.getGroup("actions",!1)}async list(){return{meta:{pagination:{limit:"not defined",offset:"not defined"}},items:null!=this.collection?await(await this.collection.takeAll()).toArray():[]}}async detail(){return null!=this.collection?await this.collection.find(this.recordId):{}}async create(){return null!=this.collection?await this.collection.create(this.recordBody):{}}async update(){return null!=this.collection?await this.collection.update(this.recordId,this.recordBody):{}}async delete(){null!=this.collection&&await this.collection.delete(this.recordId),this.context.status=204}async destroy(){null!=this.collection&&await this.collection.destroy(this.recordId),this.context.status=204}beforeActionHook(...e){return[this.context]=e,e}getRecordId(...e){return this.recordId=this.context.pathParams[this.keyName],e}getRecordBody(...e){const t=this.context.request.body;return this.recordBody=t&&t[this.itemEntityName]||void 0,e}omitBody(...e){if(this.recordBody=R.omit(this.recordBody,["_id","_rev","rev","type","_type","_owner","_space","_from","_to"]),null!=this.collection){const e=this.collection.delegate.moduleName(),t=this.collection.delegate.name;this.recordBody.type=`${e}::${t}`}return e}beforeUpdate(...e){return this.recordBody=E({},this.recordBody,{id:this.recordId}),e}async doAction(e,t){const r=await("function"==typeof this[e]?this[e](t):void 0);return this.actionResult=r,await this.saveDelayeds(),r}async saveDelayeds(){}async execute(t){let r;const{ERROR:o,DEBUG:i,LEVELS:s,SEND_TO_LOG:n}=e.NS.Pipes.NS.LogMessage,p=(t.getName(),t.getBody()),a=t.getType();try{this.send(n,">>>>>>>>>>>>>> EXECUTION START",s[i]),r={result:await this.doAction(a,p.context),resource:this},this.send(n,">>>>>>>>>>>>>> EXECUTION END",s[i])}catch(e){r={error:e,resource:this}}this.send(b,r,p.reverse)}},h.__filename="/commands/Resource.js",h.object={},q(s=d,"__filename",[D],(n=(n=Object.getOwnPropertyDescriptor(s,"__filename"))?n.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return n}}),s),q(s,"object",[w],(p=(p=Object.getOwnPropertyDescriptor(s,"object"))?p.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return p}}),s),q(s.prototype,"entityName",[j],Object.getOwnPropertyDescriptor(s.prototype,"entityName"),s.prototype),q(s.prototype,"checkExistence",[_],Object.getOwnPropertyDescriptor(s.prototype,"checkExistence"),s.prototype),q(s.prototype,"keyName",[j],Object.getOwnPropertyDescriptor(s.prototype,"keyName"),s.prototype),q(s.prototype,"itemEntityName",[j],Object.getOwnPropertyDescriptor(s.prototype,"itemEntityName"),s.prototype),q(s.prototype,"listEntityName",[j],Object.getOwnPropertyDescriptor(s.prototype,"listEntityName"),s.prototype),q(s.prototype,"collectionName",[j],Object.getOwnPropertyDescriptor(s.prototype,"collectionName"),s.prototype),a=q(s.prototype,"_collectionFactory",[o,j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q(s.prototype,"collection",[j],Object.getOwnPropertyDescriptor(s.prototype,"collection"),s.prototype),c=q(s.prototype,"context",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),l=q(s.prototype,"recordId",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=q(s.prototype,"recordBody",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=q(s.prototype,"actionResult",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q(s,"actions",[j],Object.getOwnPropertyDescriptor(s,"actions"),s),q(s.prototype,"list",[P],Object.getOwnPropertyDescriptor(s.prototype,"list"),s.prototype),q(s.prototype,"detail",[P],Object.getOwnPropertyDescriptor(s.prototype,"detail"),s.prototype),q(s.prototype,"create",[P],Object.getOwnPropertyDescriptor(s.prototype,"create"),s.prototype),q(s.prototype,"update",[P],Object.getOwnPropertyDescriptor(s.prototype,"update"),s.prototype),q(s.prototype,"delete",[P],Object.getOwnPropertyDescriptor(s.prototype,"delete"),s.prototype),q(s.prototype,"destroy",[P],Object.getOwnPropertyDescriptor(s.prototype,"destroy"),s.prototype),q(s.prototype,"beforeActionHook",[_],Object.getOwnPropertyDescriptor(s.prototype,"beforeActionHook"),s.prototype),q(s.prototype,"getRecordId",[_],Object.getOwnPropertyDescriptor(s.prototype,"getRecordId"),s.prototype),q(s.prototype,"getRecordBody",[_],Object.getOwnPropertyDescriptor(s.prototype,"getRecordBody"),s.prototype),q(s.prototype,"omitBody",[_],Object.getOwnPropertyDescriptor(s.prototype,"omitBody"),s.prototype),q(s.prototype,"beforeUpdate",[_],Object.getOwnPropertyDescriptor(s.prototype,"beforeUpdate"),s.prototype),q(s.prototype,"doAction",[_],Object.getOwnPropertyDescriptor(s.prototype,"doAction"),s.prototype),q(s.prototype,"saveDelayeds",[_],Object.getOwnPropertyDescriptor(s.prototype,"saveDelayeds"),s.prototype),q(s.prototype,"execute",[_],Object.getOwnPropertyDescriptor(s.prototype,"execute"),s.prototype),i=s))||i)||i)};exports.TemplatableModule=e=>{const{initializeMixin:t,meta:r,property:o,method:i}=e.NS,s=Symbol.for("~templatesMap"),n=Symbol.for("~templatesList"),p=Symbol.for("~templates"),a=Symbol.for("~templatesHandler");return["TemplatableModule",e=>{var c,l,u,y,h;let d=t((h=y=class extends e{get Templates(){const e=this.constructor;return null!=e[p]?e[p]:e[p]=new Proxy(e,e[a])}static get templates(){return this.metaObject.getGroup("templates",!1)}static defineTemplate(e,t){const r=`${this.prototype.ROOT||"."}/templates/`,o=e.replace(r,"").replace(/\.js/,"");return this.metaObject.addMetaData("templates",o,t),t}static resolveTemplate(...e){const t=`${this.prototype.ROOT||"."}/templates/`,r=b.resolve(...e).replace(t,"").replace(/\.js/,"");return this.prototype.Templates[r]}},y.object={},q(l=h,"object",[r],(u=(u=Object.getOwnPropertyDescriptor(l,"object"))?u.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return u}}),l),q(l.prototype,"Templates",[o],Object.getOwnPropertyDescriptor(l.prototype,"Templates"),l.prototype),q(l,"templates",[o],Object.getOwnPropertyDescriptor(l,"templates"),l),q(l,"defineTemplate",[i],Object.getOwnPropertyDescriptor(l,"defineTemplate"),l),q(l,"resolveTemplate",[i],Object.getOwnPropertyDescriptor(l,"resolveTemplate"),l),c=l))||c;return Reflect.defineProperty(d,s,{enumerable:!0,writable:!0,value:null}),Reflect.defineProperty(d,p,{enumerable:!0,writable:!0,value:null}),Reflect.defineProperty(d,a,{enumerable:!0,value:{get:(e,t)=>{if(!Reflect.get(e.templates,t)){if(null==e[s]){const t={},r=`${e.prototype.ROOT||"."}/templates/`;for(const o of e[n]){t[o.replace(r,"").replace(/\.js/,"")]=o}e[s]=t}const r=e[s][t];r&&e.resolve(r)}return Reflect.get(e.templates,t)}}}),Reflect.defineProperty(d,"onMetalize",{configurable:!0,enumerable:!0,writable:!0,value:function(...e){Reflect.getPrototypeOf(d).onMetalize.apply(this,e),this[s]=void 0,this[p]=void 0}}),d}]},exports.default=e=>{const{initializeMixin:r,meta:o,constant:i,method:s,extend:n,decorator:p,util:a}=e.NS;return["RestfulAddon",e=>{var s,c,l,u,y,h,d,b,g,m,O,f,w,j;return n("RestfulFacadeMixin","Facade")(s=te(s=A(s=B(s=H(s=U(s=G(s=V(s=J(s=Q(s=W(s=X(s=K(s=Y(s=Z(s=ee(s=de(s=he(s=le(s=pe(s=ne(s=se(s=ie(s=re(s=r((j=w=class extends e{constructor(...e){super(...e),M(this,"NON_OVERRIDDEN",u,this),M(this,"NON_RENDERABLE",y,this),M(this,"RESOURCE_RESULT",h,this),M(this,"APPLICATION_ROUTER",d,this),M(this,"JSON_RENDERER",b,this),M(this,"HTTP_MEDIATOR",g,this),M(this,"METHODS",m,this),M(this,"action",O,this),M(this,"statuses",f,this)}},w.object={},q(c=j,"object",[o],(l=(l=Object.getOwnPropertyDescriptor(c,"object"))?l.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return l}}),c),u=q(c.prototype,"NON_OVERRIDDEN",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Symbol.for("NON_OVERRIDDEN")}}),y=q(c.prototype,"NON_RENDERABLE",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Symbol.for("NON_RENDERABLE")}}),h=q(c.prototype,"RESOURCE_RESULT",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"RESOURCE_RESULT"}}),d=q(c.prototype,"APPLICATION_ROUTER",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"ApplicationRouter"}}),b=q(c.prototype,"JSON_RENDERER",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"JsonRenderer"}}),g=q(c.prototype,"HTTP_MEDIATOR",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"HttpMediator"}}),m=q(c.prototype,"METHODS",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return["get","post","put","head","delete","options","trace","copy","lock","mkcol","move","purge","propfind","proppatch","unlock","report","mkactivity","checkout","merge","m-search","notify","subscribe","unsubscribe","patch","search","connect"]}}),O=q(c.prototype,"action",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return C}}),f=q(c.prototype,"statuses",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return t}}),s=c))||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s)||s}]},exports.loadTemplates=function(e){r(null!=e[$],"Target for `loadTemplates` decorator must be a Class");const{FsUtils:t}=e.NS;r(null!=t,"Target for `loadTemplates` decorator should has FsUtilsAddon");const{Utils:{filesTreeSync:o}}=t.NS,i=`${null!=e.prototype.ROOT?e.prototype.ROOT:"."}/templates`,s=o(i,{filesOnly:!0,nosort:!0}),n=(null!=s?s:[]).map((e=>{const t=e.replace(/\.js/,"");return`${i}/${t}`}));return Reflect.defineProperty(e,I,{enumerable:!0,writable:!0,value:n}),e};
